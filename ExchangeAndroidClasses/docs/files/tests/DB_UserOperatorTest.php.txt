<?php
namespace ExchangeAndroidClasses;

require_once __DIR__.'..\..\ExchangeAndroidClasses\DB_UserOperator.php';
require_once __DIR__.'..\..\ExchangeAndroidClasses\DB_MobileUser.php';
require_once './Test_DB_Connector.php';
/**
 * Generated by PHPUnit_SkeletonGenerator on 2016-08-13 at 15:55:08.
 */
class DB_UserOperatorTest extends \PHPUnit_Framework_TestCase
{
    /**
     * @var DB_UserOperator
     */
    protected $testDbConnector ;
   

    /**
     * Sets up the fixture, for example, opens a network connection.
     * This method is called before a test is executed.
     */
    protected function setUp()
    {
      $this->testDbConnector = new Test_DB_Connector();
      $this->testDbConnector->clearDataFromTables();
        
    }

    /**
     * Tears down the fixture, for example, closes a network connection.
     * This method is called after a test is executed.
     */
    protected function tearDown()
    {
        $this->testDbConnector->clearDataFromTables();
    }

    /**
     * @covers ExchangeAndroidClasses\DB_UserOperator::getUserByEmail
     * @todo   Implement testGetUserByEmail().
     */
    public function testGetUserByEmail()
    {
       $db_error = FALSE;
        $data = time();
        $u["user_login"] = "sergo";
        $u["user_email"] = "sergo3030@mail.ru";
        $u["user_password"] = "password";
        $u["user_date_registration"] = $data;
        $user = new DB_MobileUser();
        $user->setAllFromArray($u);
        $db_UserOperator = new DB_UserOperator();
        $db_UserOperator->createUser($user, $db_error);
        $id = $user->getUser_id();
        $this->assertTrue($user->getUser_id() > 0);
        $user_fromDb = $db_UserOperator->getUserByEmail($user->getUser_email(), $db_error);
        $ch1 = $user->getCheckSum();
        $ch2 = $user_fromDb->getCheckSum();
        $this->assertEquals($user->getCheckSum(), $user_fromDb->getCheckSum());
    }

    /**
     * @covers ExchangeAndroidClasses\DB_UserOperator::getUserById
     * @todo   Implement testGetUserById().
     */
    public function testGetUserById()
    {
        $db_error = FALSE;
        $data = time();
        $u["user_login"] = "sergo";
        $u["user_email"] = "sergo3030@mail.ru";
        $u["user_password"] = "password";
        $u["user_date_registration"] = $data;
        $user = new DB_MobileUser();
        $user->setAllFromArray($u);
        $db_UserOperator = new DB_UserOperator();
        $db_UserOperator->createUser($user, $db_error);
        $id = $user->getUser_id();
        $this->assertTrue($user->getUser_id() > 0);
        $user_fromDb = $db_UserOperator->getUserById($user->getUser_id(), $db_error);
        $ch1 = $user->getCheckSum();
        $ch2 = $user_fromDb->getCheckSum();
        $this->assertEquals($user->getCheckSum(), $user_fromDb->getCheckSum());
        
    }

    /**
     * @covers ExchangeAndroidClasses\DB_UserOperator::deleteUserById
     * @todo   Implement testDeleteUserById().
     */
    public function testDeleteUserById()
    {
       $db_error = FALSE;
        $data = time();
        $u["user_login"] = "sergo";
        $u["user_email"] = "sergo3030@mail.ru";
        $u["user_password"] = "password";
        $u["user_date_registration"] = $data;
        $user = new DB_MobileUser();
        $user->setAllFromArray($u);
        $db_UserOperator = new DB_UserOperator();
        $db_UserOperator->createUser($user, $db_error);
        $id = $user->getUser_id();
        $this->assertTrue($user->getUser_id() > 0);
        $result = $db_UserOperator->deleteUserById($user->getUser_id(), $db_error);
        
        $this->assertTrue($result);
    }

    /**
     * @covers ExchangeAndroidClasses\DB_UserOperator::updateUser
     * @todo   Implement testUpdateUser().
     */
    public function testUpdateUser()
    {
        $db_error = FALSE;
        $data = time();
        $u["user_login"] = "sergo";
        $u["user_email"] = "sergo3030@mail.ru";
        $u["user_password"] = "password";
        $u["user_date_registration"] = $data;
        $user = new DB_MobileUser();
        $user->setAllFromArray($u);
        $db_UserOperator = new DB_UserOperator();
        $db_UserOperator->createUser($user, $db_error);
        $user->setUser_email("a@b.lv");
        $user->setUser_login("nesergo");
        $result = $db_UserOperator->updateUser($user, $db_error);
        $this->assertTrue($result);
        $userFromDb = $db_UserOperator->getUserById($user->getUser_id(), $db_error);
        $this->assertEquals($userFromDb->getCheckSum(), $user->getCheckSum());
    }

    /**
     * @covers ExchangeAndroidClasses\DB_UserOperator::createUser
     * @todo   Implement testCreateUser().
     */
    public function testCreateUser()
    {
        $db_error = FALSE;
        $data = time();
        
        $u["user_login"] = "sergo";
        $u["user_email"] = "sergo3030@mail.ru";
        $u["user_password"] = "password";
        $u["user_date_registration"] = $data;
        $user = new DB_MobileUser();
        $user->setAllFromArray($u);
        $db_UserOperator = new DB_UserOperator();
        $db_UserOperator->createUser($user, $db_error);
        $id = $user->getUser_id();
        $this->assertTrue($user->getUser_id() > 0);
    }
}

